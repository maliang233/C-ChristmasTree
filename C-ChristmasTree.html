<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cè¯­è¨€åœ£è¯æ ‘ - 0 Error 0 Warning</title>
    <style>
        :root {
            --bg-color: #0d1117;
            --term-green: #3fb950;
            --keyword-color: #ff7b72;
            --type-color: #79c0ff;
            --string-color: #a5d6ff;
            --comment-color: #8b949e;
            --error-red: #ff0000;
            --gold: #ffd700;
            --null-color: #ff4444; /* ç©ºæŒ‡é’ˆä¸“ç”¨è‰² */
        }

        body {
            background-color: var(--bg-color);
            color: #c9d1d9;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            user-select: none;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ æ¨¡æ‹Ÿ IDE */
        .ide-header {
            width: 100%;
            background: #161b22;
            border-bottom: 1px solid #30363d;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .filename {
            font-size: 14px;
            color: var(--comment-color);
        }

        .controls button {
            background: #238636;
            border: 1px solid rgba(240, 246, 252, 0.1);
            color: white;
            padding: 5px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            margin-left: 10px;
            transition: all 0.2s;
        }

        .controls button:hover {
            background: #2ea043;
        }

        .controls button.danger {
            background: #da3633;
        }
        .controls button.danger:hover {
            background: #f85149;
        }

        /* ä¸»ä½“åŒºåŸŸ */
        .main-stage {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 100%;
        }

        /* åœ£è¯æ ‘å®¹å™¨ */
        .code-tree {
            text-align: center;
            line-height: 1.2;
            font-size: 14px; /* Default size */
            white-space: pre;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
            transition: transform 0.5s ease;
            position: relative;
            z-index: 2;
        }

        /* æ ‘çš„å±‚çº§ç»“æ„ */
        .tree-layer {
            display: block;
            margin: 0 auto;
            transition: color 0.3s, transform 0.3s, opacity 0.3s;
            /* å¯ç”¨ 3D å˜æ¢ä»¥è·å¾—æ›´æµç•…çš„æ•ˆæœ */
            will-change: transform, opacity;
        }

        /* æ ‘é¡¶æ˜Ÿæ˜Ÿ */
        .star {
            color: var(--gold);
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 15px var(--gold);
            animation: pulse 2s infinite;
            display: block;
            margin-bottom: 5px;
            cursor: help; /* é¼ æ ‡æ”¾ä¸Šå»æ˜¯é—®å· */
            transition: color 0.2s;
        }
        
        /* ç©ºæŒ‡é’ˆçŠ¶æ€çš„æ˜Ÿæ˜Ÿ */
        .star.is-null {
            color: var(--error-red);
            text-shadow: 0 0 10px var(--error-red);
            font-family: 'Courier New', monospace;
        }

        /* ä»£ç é«˜äº®ç±» */
        .kw { color: var(--keyword-color); } /* keyword */
        .tp { color: var(--type-color); } /* type */
        .str { color: var(--string-color); } /* string */
        .cm { color: var(--comment-color); } /* comment */
        .op { color: #d2a8ff; } /* operator */
        .fn { color: #d2a8ff; } /* function */
        .nl { color: var(--null-color); font-weight: bold; } /* NULL Special */

        /* ç¯å…‰é—ªçƒåŠ¨ç”» */
        .light-up .kw, .light-up .tp, .light-up .str {
            text-shadow: 0 0 8px currentColor;
        }
        
        /* NULL é—ªçƒ */
        .light-up .nl {
             animation: null-blink 1s infinite alternate;
        }

        /* ç»ˆç«¯åŒºåŸŸ */
        .terminal {
            width: 100%;
            height: 150px;
            background: #000;
            border-top: 1px solid #30363d;
            padding: 10px;
            font-size: 12px;
            overflow-y: auto;
            box-sizing: border-box;
            z-index: 10;
        }

        .terminal-line {
            margin: 2px 0;
            opacity: 0.8;
        }
        .terminal-line.error { color: var(--error-red); }
        .terminal-line.success { color: var(--term-green); }
        .terminal-line.warn { color: var(--gold); }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 14px;
            background: var(--term-green);
            animation: blink 1s step-end infinite;
            vertical-align: middle;
        }

        /* é£˜è½çš„ä»£ç é›¨/é›ªèŠ± */
        .snow-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .snowflake {
            position: absolute;
            color: rgba(255, 255, 255, 0.3);
            font-size: 12px;
            animation: fall linear infinite;
        }
        
        .snowflake.null-flake {
            color: rgba(255, 100, 100, 0.4);
            font-weight: bold;
        }

        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; text-shadow: 0 0 20px var(--gold); }
            100% { transform: scale(1); opacity: 0.8; }
        }

        @keyframes null-blink {
            0% { opacity: 0.5; text-shadow: none; }
            100% { opacity: 1; text-shadow: 0 0 10px var(--error-red); }
        }

        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0.8; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        @keyframes blink { 50% { opacity: 0; } }

        /* å±å¹•éœ‡åŠ¨åŠ¨ç”» */
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        /* æ•…éšœé—ªçƒ */
        @keyframes glitch {
            0% { opacity: 1; filter: none; }
            50% { opacity: 0.8; filter: hue-rotate(90deg) blur(1px); }
            100% { opacity: 1; filter: none; }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 600px) {
            .code-tree { font-size: 10px; }
            .ide-header h1 { display: none; }
        }
    </style>
</head>
<body>

    <div class="ide-header">
        <div class="filename">ğŸ„ christmas_tree.c [Read-Only]</div>
        <div class="controls">
            <button onclick="compileTree()">gcc -o tree tree.c</button>
            <button onclick="runTree()">./tree</button>
            <button class="danger" onclick="segFault()">free(tree)</button>
        </div>
    </div>

    <div class="main-stage">
        <div class="snow-container" id="snowContainer"></div>
        
        <div class="code-tree" id="codeTree">
            <!-- æ ‘é¡¶ -->
            <div class="star" id="treeStar" onmouseover="hoverStar()" onmouseout="leaveStar()" onclick="clickStar()">*ptr</div>
            
            <!-- æ ‘çš„å†…å®¹ç”± JS ç”Ÿæˆ -->
        </div>
    </div>

    <div class="terminal" id="terminal">
        <div class="terminal-line">gcc version 12.2.0 (Debian 12.2.0-14)</div>
        <div class="terminal-line">Copyright (C) 2024 Free Software Foundation, Inc.</div>
        <div class="terminal-line">> waiting for command...<span class="cursor"></span></div>
    </div>

    <script>
        // Cè¯­è¨€å…³é”®è¯åº“
        const keywords = [
            "int", "char", "void", "float", "double", "struct", 
            "if", "else", "for", "while", "return", "break", 
            "malloc", "free", "printf", "NULL", "true", 
            "{", "}", ";", "&&", "->", "&", "*"
        ];
        
        // ä¸“é—¨çš„"ç©ºæŒ‡é’ˆ"æ¢—ä»£ç æ®µï¼Œä¼šéšæœºæ’å…¥
        const nullPhrases = [
            "if(ptr==NULL)",
            "return NULL;",
            "void* p=0;",
            "while(!ptr)",
            "assert(ptr);",
            "ptr=NULL;"
        ];

        // æ„å»ºåœ£è¯æ ‘
        function buildTree() {
            const treeContainer = document.getElementById('codeTree');
            // æ¸…ç©ºé™¤äº†æ˜Ÿæ˜Ÿä¹‹å¤–çš„å†…å®¹
            while(treeContainer.children.length > 1) {
                treeContainer.removeChild(treeContainer.lastChild);
            }
            
            const levels = 18; // æ ‘çš„é«˜åº¦

            for (let i = 0; i < levels; i++) {
                const layer = document.createElement('div');
                layer.className = 'tree-layer';
                
                let lineContent = "";
                // 15% æ¦‚ç‡æ’å…¥ä¸€ä¸ªå®Œæ•´çš„ NULL ç›¸å…³çš„ä»£ç æ¢—
                if (Math.random() < 0.15) {
                    lineContent = nullPhrases[Math.floor(Math.random() * nullPhrases.length)];
                    // è¡¥å…¨é•¿åº¦
                    let padding = generateCodeLine(Math.max(0, (i + 2) - 2));
                    if(Math.random() > 0.5) lineContent = lineContent + " " + padding;
                    else lineContent = padding + " " + lineContent;
                } else {
                    lineContent = generateCodeLine(i + 2);
                }
                
                layer.innerHTML = highlightSyntax(lineContent);
                treeContainer.appendChild(layer);
            }

            // æ ‘å¹²
            const trunk = document.createElement('div');
            trunk.className = 'tree-layer';
            trunk.style.marginTop = '5px';
            trunk.innerHTML = highlightSyntax("return 0;");
            treeContainer.appendChild(trunk);
            
            const trunk2 = document.createElement('div');
            trunk2.className = 'tree-layer';
            trunk2.innerHTML = highlightSyntax("}");
            treeContainer.appendChild(trunk2);
        }

        // ç”Ÿæˆéšæœºä»£ç è¡Œ
        function generateCodeLine(length) {
            let line = "";
            let remaining = length;
            
            while(remaining > 0) {
                const token = keywords[Math.floor(Math.random() * keywords.length)];
                line += token + " ";
                remaining--;
            }
            return line.trim();
        }

        // ç®€æ˜“è¯­æ³•é«˜äº®
        function highlightSyntax(text) {
            return text.split(' ').map(token => {
                // ç‰¹æ®Šé«˜äº® NULL
                if (token === "NULL" || token.includes("NULL")) return `<span class="nl">${token}</span>`;
                
                if (["int", "char", "void", "float", "double", "struct"].includes(token)) return `<span class="tp">${token}</span>`;
                if (["if", "else", "for", "while", "return", "sizeof", "malloc", "free"].includes(token)) return `<span class="kw">${token}</span>`;
                if (["printf", "scanf"].includes(token)) return `<span class="fn">${token}</span>`;
                if (token.includes("*") || token.includes("&") || token.includes("->")) return `<span class="op">${token}</span>`;
                if (token === "{" || token === "}") return `<span class="op">${token}</span>`;
                return `<span class="str">${token}</span>`;
            }).join(' ');
        }

        // ç»ˆç«¯è¾“å‡ºåŠŸèƒ½
        function log(message, type = '') {
            const term = document.getElementById('terminal');
            const line = document.createElement('div');
            line.className = `terminal-line ${type}`;
            line.innerText = `> ${message}`;
            term.insertBefore(line, term.lastElementChild);
            term.scrollTop = term.scrollHeight;
        }

        // æ¨¡æ‹Ÿä¸‹é›ªï¼ˆåŠ å…¥ç©ºæŒ‡é’ˆå…ƒç´ ï¼‰
        function createSnow() {
            const container = document.getElementById('snowContainer');
            // æ™®é€šé›ªèŠ±
            const symbols = [';', '{', '}', '*', '&', '//', '0x00'];
            // ç¨€æœ‰é›ªèŠ± (Null Pointer)
            const nullSymbols = ['NULL', '(void*)0', '\\0', '0x0'];
            
            setInterval(() => {
                const flake = document.createElement('div');
                const isNull = Math.random() < 0.2; // 20% æ¦‚ç‡ç”Ÿæˆç©ºæŒ‡é’ˆé›ªèŠ±
                
                if (isNull) {
                    flake.className = 'snowflake null-flake';
                    flake.innerText = nullSymbols[Math.floor(Math.random() * nullSymbols.length)];
                    flake.style.fontSize = '10px';
                } else {
                    flake.className = 'snowflake';
                    flake.innerText = symbols[Math.floor(Math.random() * symbols.length)];
                }
                
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.animationDuration = (Math.random() * 5 + 3) + 's';
                flake.style.opacity = Math.random();
                
                container.appendChild(flake);

                setTimeout(() => {
                    flake.remove();
                }, 8000);
            }, 200);
        }

        // --- æ˜Ÿæ˜Ÿäº¤äº’é€»è¾‘ ---
        function hoverStar() {
            const star = document.getElementById('treeStar');
            if(star.innerText !== "NULL") {
                star.dataset.original = star.innerText;
                star.innerText = "NULL";
                star.classList.add('is-null');
            }
        }

        function leaveStar() {
            const star = document.getElementById('treeStar');
            star.innerText = "*ptr";
            star.classList.remove('is-null');
        }

        function clickStar() {
            log("RUNTIME ERROR: Dereferencing NULL pointer at tree_top!", "error");
            
            // å°å°çš„æ•…éšœåŠ¨ç”»
            const tree = document.getElementById('codeTree');
            tree.style.animation = "glitch 0.2s cubic-bezier(.25, .46, .45, .94) both infinite";
            setTimeout(() => { tree.style.animation = ""; }, 400);
        }
        // ------------------

        // äº¤äº’åŠŸèƒ½ 1: ç¼–è¯‘
        function compileTree() {
            log("gcc -o christmas_tree tree.c -Wall");
            setTimeout(() => {
                log("Compiling...", "warn");
            }, 500);
            
            setTimeout(() => {
                const tree = document.getElementById('codeTree');
                
                // å¤æ´»é€»è¾‘
                tree.style.filter = "none";
                tree.style.opacity = "1";
                document.body.style.animation = "";
                const layers = Array.from(tree.children);
                layers.forEach(layer => {
                    layer.style.transition = ""; 
                    layer.style.transform = "";
                    layer.style.opacity = "";
                });

                if(tree.style.display === 'none') {
                     tree.style.display = 'block';
                }
                tree.classList.add('light-up');
                
                log("Build finished successfully.", "success");
                log("0 Errors, 0 Warnings. (Code review skipped)", "success");
            }, 1500);
        }

        // äº¤äº’åŠŸèƒ½ 2: è¿è¡Œ
        function runTree() {
            const tree = document.getElementById('codeTree');
            if (!tree.classList.contains('light-up')) {
                log("Error: Please compile first!", "error");
                return;
            }

            log("./christmas_tree");
            
            const events = [
                { msg: "Merry Christmas! Wish you no bugs.", type: "success" },
                { msg: "Segmentation fault (core dumped) - ç¤¼ç‰©æŒ‡é’ˆä¸ºç©º", type: "error" },
                { msg: "Infinite Loop detected... happiness++", type: "warn" },
                { msg: "Memory Leak: è¿™é‡Œçš„æ¬¢ä¹æ²¡æœ‰è¢« free()", type: "warn" },
                { msg: "Stack Overflow: ç¤¼ç‰©å¤ªå¤šæº¢å‡ºäº†", type: "error" },
                { msg: "NullPointerException? ä¸ï¼Œè¿™é‡Œæ˜¯Cï¼Œæˆ‘ä»¬ç›´æ¥å´©æºƒã€‚", type: "error" },
                { msg: "Warning: implicit declaration of function 'santa_claus'", type: "warn" }
            ];

            const randomEvent = events[Math.floor(Math.random() * events.length)];
            
            setTimeout(() => {
                log(randomEvent.msg, randomEvent.type);
                if (randomEvent.msg.includes("Segmentation") || randomEvent.msg.includes("å´©æºƒ")) {
                    tree.style.animation = "glitch 0.2s cubic-bezier(.25, .46, .45, .94) both infinite";
                    setTimeout(() => { tree.style.animation = ""; }, 600);
                }
            }, 800);
        }

        // äº¤äº’åŠŸèƒ½ 3: é‡Šæ”¾å†…å­˜
        function segFault() {
            log("free(tree_ptr);");
            log("tree_ptr = NULL; // Good practice", "warn");
            log("Attempting to free memory...", "warn");
            
            const tree = document.getElementById('codeTree');
            const layers = Array.from(tree.children);

            document.body.style.animation = "shake 0.5s cubic-bezier(.36,.07,.19,.97) both";
            tree.style.filter = "hue-rotate(90deg) contrast(150%) blur(0.5px)";
            
            setTimeout(() => {
                layers.forEach((layer) => {
                    const randomX = (Math.random() - 0.5) * 800; 
                    const randomRotate = (Math.random() - 0.5) * 720; 
                    const randomDrop = 500 + Math.random() * 500; 
                    const duration = 0.8 + Math.random() * 1.5; 
                    const delay = Math.random() * 0.3; 
                    
                    layer.style.transition = `all ${duration}s ease-in ${delay}s`;
                    layer.style.transform = `translate(${randomX}px, ${randomDrop}px) rotate(${randomRotate}deg)`;
                    layer.style.opacity = '0';
                });

                log("Segmentation fault (core dumped)", "error");
                log("System halted. Christmas is cancelled.", "error");
            }, 400);

            setTimeout(() => {
                document.body.style.animation = "";
            }, 500);
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            buildTree();
            createSnow();
            setTimeout(() => log("Initialize merry_christmas.h ..."), 500);
        };

    </script>
</body>
</html>